# DHI精准筛查助手 - 版本更新日志

本文档记录了DHI精准筛查助手的所有版本历史和重要更新。

---

## [v3.4] - 2025-07-16

### 🚀 OneDIR模式构建优化 ⭐
- **专注PyInstaller OneDIR模式构建**
  - 确保使用onedir模式，避免onefile启动慢的问题
  - 构建输出为完整的应用目录结构
  - 启动速度优化到2-3秒
  - 文件结构清晰，便于调试和维护

### 📦 完整分发包生成
- **自动创建用户友好的分发包**
  - 包含完整的OneDIR应用目录
  - 自动生成详细的使用说明文档
  - 提供桌面快捷方式创建脚本
  - 复制所有必要的文档和资源文件

### 🔧 构建流程简化
- **移除复杂的安装包生成**
  - 专注于EXE构建，用户自行制作安装包
  - 简化GitHub Actions workflow
  - 提供ZIP压缩包便于分发
  - 增强构建过程的监控和日志

### 📋 用户体验改进
- **提供完整的部署解决方案**
  - 详细的构建信息和系统要求说明
  - 自动生成的快捷方式创建工具
  - 清晰的目录结构和使用指南
  - 支持GitHub Artifacts下载

**发布日期**: 2025-07-16  
**版本状态**: 稳定版 - OneDIR快速启动  
**提交哈希**: 待更新  

---

## [v3.3] - 2025-07-15

### 🔧 架构兼容性根本修复 ⭐
- **彻底解决Windows安装架构限制问题**
  - 修复主要构建workflow中的Inno Setup配置错误
  - 将ArchitecturesAllowed从'x64'改为'x86 x64'
  - 移除ArchitecturesInstallIn64BitMode限制
  - 确保安装包可在32位和64位Windows系统上正常安装
  - 升级到v3.3版本，包含所有架构兼容性修复

### 📋 建立构建规范体系
- **完善项目构建规则**
  - 在rules.yaml中详细记录架构兼容性问题和解决方案
  - 建立GitHub Actions构建规范和质量保证清单
  - 提供架构问题预防检查清单和验证步骤
  - 规范多架构安装包的命名和版本管理

### 🎯 用户体验改进
- **增强系统兼容性**
  - 32位Windows系统用户现在可正常安装x86版本
  - 64位Windows系统用户可选择任意版本
  - 提供清晰的系统架构选择指南
  - 改进安装包的错误提示和用户引导

### 🔬 技术改进
- **优化构建流程**
  - 改进PyInstaller spec文件的架构特定配置
  - 增强Inno Setup脚本的动态生成逻辑
  - 完善构建过程的错误处理和调试信息
  - 建立多架构构建的最佳实践

**发布日期**: 2025-07-15  
**版本状态**: 稳定版 - 架构兼容性修复  
**提交哈希**: 0ee4310  

---

## [v3.2] - 2025-07-15

### 🚀 多架构支持
- **新增多架构自动化构建**
  - 支持Windows x64和x86两种架构的安装包
  - 使用GitHub Actions自动构建和发布
  - 每个架构生成独立的安装程序
  
### ✨ 性状筛选优化  
- **更新性状列表**
  - 精确匹配实际需求的23个核心性状
  - 包含：乳脂率、脂蛋比、体细胞数/分、尿素氮、乳糖率等
  - 移除不需要的冗余性状项目

### 📊 加权平均功能扩展
- **新增多种加权平均计算**
  - 乳脂率加权平均：平均乳脂率(%)
  - 乳糖率加权平均：平均乳糖率(%) 
  - 蛋白率加权平均：平均蛋白率(%)
  - 统一计算公式：Σ(性状值×产奶量) / Σ(产奶量)

### 🔧 技术改进
- **GitHub Actions自动化**
  - 支持推送时自动构建
  - 创建Git标签时自动发布
  - 支持手动触发构建
  - 多架构并行构建提高效率

### 🐛 架构兼容性修复
- **修复Windows架构安装限制问题**
  - 问题：x86安装包错误显示"只能安装在x64架构"
  - 原因：Inno Setup架构配置错误
  - 修复：正确配置x86版本的ArchitecturesAllowed设置
  - 结果：x86版本可在32位和64位系统上安装

### 📦 安装包优化
- **增强用户体验**
  - 自动检测系统架构
  - 提供清晰的架构选择说明
  - 优化安装程序大小和性能
  - 完善的卸载和升级机制

**发布日期**: 2025-07-15  
**版本状态**: 稳定版  
**提交哈希**: 待更新  

---

## [v3.1] - 2025-07-15

### 🐛 关键Bug修复
- **修复筛选完全失效的严重Bug**
  - 问题：当DHI数据无farm_id字段时，`apply_multi_filter_logic`函数错误跳过所有特殊筛选项
  - 影响：蛋白率、乳脂率等所有数值筛选完全失效
  - 修复：将farm_id检查改为可选，只要求management_id字段存在
  - 验证：单月和多月筛选均正常工作

### 🎨 界面显示优化
- **修复字体颜色显示问题**
  - 强制设置表格、文件信息、处理过程等界面为黑色字体
  - 确保在各种背景下文字都能清晰可见
  - 修复月度报告显示中的字体颜色问题

### 📤 数据导出修复
- **修复Excel导出错误**
  - 解决`create_monthly_report`中元组数据导致的"Cannot convert tuple to Excel"错误
  - 确保management_id数据格式一致性
  - 优化无farm_id数据的处理逻辑

### ✅ 验证项目
- [x] 单月数据筛选功能
- [x] 多月数据筛选功能  
- [x] 蛋白率/乳脂率筛选功能
- [x] 空值处理逻辑
- [x] 界面显示清晰度
- [x] Excel导出功能

**发布日期**: 2025-07-15  
**版本状态**: 稳定版  
**提交哈希**: bd75f73

---

## [v3.0] - 2025-07-08

### 🚀 重大功能升级

#### 新增核心功能
- **隐形乳房炎月度监测系统**
  - 当月流行率计算
  - 新发感染率计算
  - 慢性感染率计算
  - 慢性感染牛占比计算
  - 头胎/经产首测流行率计算
  - 干奶前流行率计算

- **慢性乳房炎筛查处置系统**
  - 5种处置办法判断逻辑
  - 智能条件匹配
  - 专业报告生成

- **牛群基础信息智能处理**
  - 支持伊起牛系统数据
  - 支持慧牧云系统数据
  - 支持自定义系统数据
  - 智能数据匹配算法

#### 用户体验优化
- **现代化界面设计**
  - 功能模块化布局
  - 智能颜色自适应
  - 响应式界面设计

- **防呆设计系统**
  - 详细计算过程展示
  - 完善的错误处理机制
  - 智能提示和引导

#### 技术架构升级
- **实时数据分析引擎**
- **灵活配置选项系统**
- **专业报告导出功能**
- **全面调试诊断系统**

**发布日期**: 2025-07-08  
**版本状态**: 稳定版  
**提交哈希**: fb71537

---

## [v2.x] - 开发阶段版本

### 功能迭代历程
- **GitHub Actions集成**: 自动化Windows EXE构建
- **Windows兼容性**: 解决文件命名和路径问题
- **PyInstaller优化**: 修复数据文件引用和numpy兼容性
- **安装包生成**: Inno Setup自动化打包
- **多架构支持**: 支持不同Windows版本

---

## [v1.x] - 初始版本

### 基础功能
- **DHI数据处理**: 基础的数据读取和处理功能
- **蛋白筛选**: 基本的蛋白率筛选逻辑
- **界面框架**: 初始的桌面应用界面

**发布日期**: 2025年初  
**版本状态**: 开发版

---

## 版本回退指南

### 如何回退到特定版本

1. **回退到v3.1 (推荐稳定版)**
   ```bash
   git checkout v3.1
   ```

2. **回退到v3.0 (功能完整版)**
   ```bash
   git checkout v3.0
   ```

3. **查看所有可用版本**
   ```bash
   git tag --list
   ```

4. **恢复到最新版本**
   ```bash
   git checkout main
   ```

### 版本选择建议

- **生产环境**: 推荐使用 `v3.1` (最新稳定版)
- **功能测试**: 可使用 `v3.0` (功能完整)
- **开发调试**: 使用 `main` 分支 (最新开发版)

---

## 更新计划

### 下一版本 (v3.2) 计划
- [ ] 性能优化
- [ ] 更多数据源支持
- [ ] 报告模板定制
- [ ] 批量处理功能

### 长期规划
- [ ] 云端数据同步
- [ ] 移动端支持
- [ ] 机器学习预测功能
- [ ] API接口开放

---

*最后更新: 2025-07-15*  
*维护者: DHI开发团队* 