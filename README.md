# DHI筛查助手 v4.01

## 项目概述

DHI筛查助手是一款专业的奶牛群体健康管理软件，基于DHI（Dairy Herd Improvement）检测数据，为牧场提供全方位的数据分析和决策支持。软件采用PyQt6开发，提供直观易用的桌面应用界面，支持Windows和macOS平台。

## 核心功能模块

### 1. DHI基础筛选
- **批量文件处理**：支持ZIP压缩包和Excel文件的批量上传和处理
- **智能格式识别**：自动识别新旧版本DHI报告格式，兼容多种文件命名规范
- **多维度筛选**：支持23种性状指标的灵活筛选，包括：
  - 基础指标：胎次、采样日期、泌乳天数
  - 生产性能：产奶量、乳脂率、蛋白率、乳糖率
  - 健康指标：体细胞数、尿素氮、体细胞评分
  - 其他指标：脂蛋比、固形物、成年当量等
- **加权平均计算**：采用产奶量加权平均算法，更准确反映群体生产水平
- **月度报告生成**：按月展开数据，直观展示各项指标变化趋势

### 2. 隐性乳房炎监测
- **六大核心指标**：
  - 当月流行率：当前月份体细胞数超标牛只比例
  - 新发感染率：新增感染牛只占比
  - 慢性感染率：连续感染牛只占比
  - 慢性感染牛占比：慢性感染牛在总牛群中的比例
  - 干奶前流行率：干奶前期牛只的感染情况
  - 头胎/经产牛首测流行率：不同胎次牛只的感染率对比
- **慢性感染识别**：自动识别连续3个月以上体细胞数超标的牛只
- **处置建议生成**：基于感染情况提供5种针对性处置方案
- **数据可视化**：生成月度趋势图表，直观展示防控效果

### 3. 尿素氮追踪分析
- **泌乳阶段分组**：按泌乳天数将牛群分为12个阶段
  - 新产期：1-30天
  - 高峰期：31-60天
  - 稳定期：61-90天
  - 中后期：91-330天（每30天一组）
  - 干奶前：331天以上
- **趋势分析**：使用pyqtgraph绘制各阶段尿素氮变化曲线
- **异常值筛选**：自动标记尿素氮<5或>30的异常个体
- **统计分析**：计算各组均值、标准差、最值等统计指标
- **详细清单导出**：生成包含所有牛只明细的Excel报告

## 技术架构

### 前端技术栈
- **GUI框架**：PyQt6 - 提供现代化的桌面应用界面
- **图表库**：pyqtgraph - 高性能的数据可视化
- **样式系统**：自定义CSS样式，支持主题切换和DPI自适应

### 后端技术栈
- **数据处理**：pandas - 强大的数据分析和处理能力
- **文件处理**：支持Excel（xlsx/xls）、ZIP压缩包
- **数据库**：阿里云MySQL - 用户认证和权限管理

### 核心模块
- `desktop_app.py`：主界面和业务逻辑
- `data_processor.py`：数据处理核心引擎
- `mastitis_monitoring.py`：隐性乳房炎监测算法
- `urea_tracker.py`：尿素氮追踪分析算法
- `auth_module/`：用户认证和权限管理

## 系统要求

### 运行环境
- **操作系统**：Windows 10/11、macOS 10.14+、Linux
- **Python版本**：3.8 或更高版本
- **内存要求**：建议 4GB 以上
- **磁盘空间**：至少 500MB 可用空间
- **网络要求**：需要网络连接用于用户认证

### 依赖包
```
PyQt6==6.5.0
pandas==2.1.4
numpy==1.26.2
openpyxl==3.1.2
pyqtgraph==0.13.3
pymysql==1.1.0
cryptography==41.0.7
PyYAML==6.0.1
```

## 安装部署

### 开发环境部署
```bash
# 1. 克隆项目
git clone <repository-url>
cd protein_screening

# 2. 创建虚拟环境
python -m venv venv

# 3. 激活虚拟环境
# Windows
venv\Scripts\activate
# macOS/Linux
source venv/bin/activate

# 4. 安装依赖
pip install -r requirements.txt

# 5. 运行程序
python desktop_app.py
```

### 生产环境部署
```bash
# 使用PyInstaller打包
pyinstaller DHI_Screening_System_v3.3.spec

# 生成Windows安装包
iscc DHI_Screening_System_v3.0_Setup.iss
```

## 配置说明

### config.yaml - 系统配置
- 应用基本信息（名称、版本）
- 文件上传限制（大小、类型）
- 临时文件目录设置
- 日志级别配置

### rules.yaml - 业务规则
- 字段映射规则（中英文对照）
- 筛选条件定义和默认值
- 文件格式兼容性设置
- 导出报告格式配置

## 数据安全

- **用户认证**：基于阿里云数据库的安全认证
- **单设备登录**：防止账号被多处同时使用
- **数据加密**：本地凭证使用Fernet加密存储
- **权限控制**：基于角色的访问控制

## 版本历史

### v4.01 (2025-07-19)
- 🚀 全面优化用户体验
- 📊 流畅进度条：所有耗时操作添加进度显示和剩余时间估算
- 📱 响应式设计：尿素氮分析表格自适应窗口大小
- 🇨🇳 中文化完善：图表右键菜单完全中文化
- 👤 用户信息增强：显示工号和姓名
- 🐛 Bug修复：解决基础筛选误触发尿素氮分析、筛选完成弹窗等问题

### v3.91 (2025-07-18)
- ✨ 新增尿素氮追踪分析功能
- 🎨 UI界面全面优化
- 🔐 登录窗口体验改进
- 🐛 修复多项显示问题

### v3.8 (2024-12-19)
- 📐 标签页宽度自适应
- 🎯 界面对齐优化

### v3.0 (2025-07-08)
- 🚀 重大功能升级
- 🦠 新增隐性乳房炎监测
- 📊 慢性乳房炎筛查系统

## 开发团队

- 产品设计：伊利奶科院 韩吉雨 王波臻 张俊杰
- 技术开发：奶科院育种中心王波臻
- 测试支持：伊利奶科院、质量管理部相关质量技术团队

## 技术支持

- 使用问题：查看操作说明文档
- Bug反馈：提交到项目Issue
- 功能建议：联系技术支持团队

## 主要特性

### 🎯 精准分析
- 多维度数据筛选，支持23种性状指标
- 智能识别数据格式，兼容新旧版本DHI报告
- 加权平均算法，准确反映群体生产水平

### 🚀 高效便捷
- 批量文件处理，支持ZIP压缩包
- 流畅的进度显示，实时估算剩余时间
- 一键导出Excel报告，格式规范易读

### 🎨 友好界面
- 现代化UI设计，操作直观
- 响应式布局，自适应窗口大小
- 完全中文化，包括图表菜单

### 🔒 安全可靠
- 阿里云数据库认证，保证数据安全
- 单设备登录限制，防止账号滥用
- 本地数据加密存储，保护隐私

---
*最后更新：2025-07-19*